
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Installing and using pt-visual-explain - Daves dev warblings</title>
  <meta name="author" content="David Yell">

  
  <meta name="description" content="Why? So I attended CakeFest this year and it was brilliant. One of the talks which I took at homework was the Profiling and Optimisation: A practical &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jedistirfry.co.uk/blog/2014-08/pt-visual-explain">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Daves dev warblings" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2775424-18']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Daves dev warblings</a></h1>
  
    <h2>For all the things I never remember</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jedistirfry.co.uk" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about.html">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Installing and using pt-visual-explain</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-28T17:14:00+01:00" pubdate data-updated="true">Aug 28<sup>th</sup>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>Why?</h3>

<p>So I attended CakeFest this year and it was brilliant. One of the talks which I took at homework was the <a href="https://joind.in/talk/view/11599">Profiling and Optimisation: A practical approach</a> by <a href="http://mark-story.com/">Mark Story</a>.</p>

<p>One the tools mentioned was <code>pt-visual-explain</code>, and I&rsquo;ve been playing with it to see how it can help me better understand my queries and what is happening when I&rsquo;m getting data.</p>

<p>I thought that I would document the process so I don&rsquo;t forget it.</p>

<h3>Install</h3>

<p>Go grab your specific platform download of <a href="http://www.percona.com/downloads/percona-toolkit/LATEST">Percona Toolkit</a>. Personally I used the <strong>tarball</strong> option for my work machine as it&rsquo;s OS X.</p>

<h4>Mac OSX</h4>

<p>Here are the instructions for installation on a Mac. I&rsquo;ve not tried it on my Ubuntu laptop, but when I do, I&rsquo;ll update this post.</p>

<p>Then I unzipped the tarball into a folder. You&rsquo;ll notice that there is a <code>Makefile.PL</code>, this is a Perl script for building the various executables you&rsquo;ll need.</p>

<p>Make sure you have Perl installed, <code>perl --version</code>, which you should be default I think. Then it&rsquo;s time to build the various executables.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>percona-toolkit-2.2.10
</span><span class='line'><span class="nv">$ </span>perl Makefile.PL
</span><span class='line'><span class="nv">$ </span>sudo make
</span><span class='line'><span class="nv">$ </span>sudo make <span class="nb">test</span>
</span><span class='line'><span class="nv">$ </span>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>Then you&rsquo;ll probably find some warnings or errors about a missing Perl package called <code>DBD::MySQL</code>. So let&rsquo;s install this. I used <a href="http://bixsolutions.net/forum/thread-8.html">this guide</a>, but I will summarise it here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>perl -MCPAN -e <span class="s1">&#39;shell&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>If this is the first time you&rsquo;ve used the Cpan module on your Mac you will be asked about configuring your Cpan set-up.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cpan&gt; get DBI
</span><span class='line'>cpan&gt; get DBD::mysql
</span><span class='line'>cpan&gt; <span class="nb">exit</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>sudo perl -MCPAN -e <span class="s1">&#39;install DBI&#39;</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~/.cpan/build/DBD-mysql-x.xxx/
</span><span class='line'><span class="nv">$ </span>perl Makefile.PL --testuser<span class="o">=</span><span class="s1">&#39;daz&#39;</span> --testpassword<span class="o">=</span><span class="s1">&#39;YOUR_PASSWORD&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t include the <code>--testpassword=''</code> argument if your database doesn&rsquo;t have a password.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>make
</span><span class='line'><span class="nv">$ </span>make <span class="nb">test</span>
</span><span class='line'><span class="nv">$ </span>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>So now it&rsquo;s time to run it and see what our queries look like.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pt-visual-explain --connect --host<span class="o">=</span>localhost --user<span class="o">=</span>root --database<span class="o">=</span>myDatabase ~/Percona/MyExampleQuery.sql
</span></code></pre></td></tr></table></div></figure>


<p>You should get a nice visual output of what is going on with your query. At this point you can add indexes, change the query and keep running the visual explainer against it to see how things are changing.</p>

<h3>Done</h3>

<p>That&rsquo;s it! Pretty simple really, apart from all that crap with Perl ;)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">David Yell</span></span>

      








  


<time datetime="2014-08-28T17:14:00+01:00" pubdate data-updated="true">Aug 28<sup>th</sup>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/mysql/'>mysql</a>, <a class='category' href='/blog/categories/optimisation/'>optimisation</a>, <a class='category' href='/blog/categories/percona/'>percona</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jedistirfry.co.uk/blog/2014-08/pt-visual-explain/" data-via="yelldavid" data-counturl="http://jedistirfry.co.uk/blog/2014-08/pt-visual-explain/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014-08/sorting-data/" title="Previous Post: Sorting multi-dimension model data">&laquo; Sorting multi-dimension model data</a>
      
      
        <a class="basic-alignment right" href="/blog/2015-02/working-with-crud/" title="Next Post: Working with the Crud plugin in CakePHP">Working with the Crud plugin in CakePHP &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015-05/jquery-ui-accordion/">jQuery UI Accordion</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-04/paginating-multiple-types-of-list-in-the-same-controller/">Paginating multiple types of list in the same controller</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-02/working-with-crud/">Working with the Crud plugin in CakePHP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-08/pt-visual-explain/">Installing and using pt-visual-explain</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-08/sorting-data/">Sorting multi-dimension model data</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/davidyell">@davidyell</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'davidyell',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/neon1024?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/neon1024">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - David Yell -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jedistirfry';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jedistirfry.co.uk/blog/2014-08/pt-visual-explain/';
        var disqus_url = 'http://jedistirfry.co.uk/blog/2014-08/pt-visual-explain/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
