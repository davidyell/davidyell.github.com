<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: search | Daves dev warblings]]></title>
  <link href="http://jedistirfry.co.uk/blog/categories/search/atom.xml" rel="self"/>
  <link href="http://jedistirfry.co.uk/"/>
  <updated>2015-05-29T14:12:42+01:00</updated>
  <id>http://jedistirfry.co.uk/</id>
  <author>
    <name><![CDATA[David Yell]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Filtering dates using CakeDC/Search]]></title>
    <link href="http://jedistirfry.co.uk/blog/2014-03/filtering-dates-using-cakedc-slash-search/"/>
    <updated>2014-03-04T10:54:00+00:00</updated>
    <id>http://jedistirfry.co.uk/blog/2014-03/filtering-dates-using-cakedc-slash-search</id>
    <content type="html"><![CDATA[<h3>Scenario</h3>

<p>I needed to do a search on a date field in my database which was stored as a <code>DATE</code>, but only filtering by month.</p>

<h3>Solution</h3>

<p>So I had already implemented the <a href="https://github.com/cakedc/search">CakeDC/Search</a> into my project, so all I needed to do was create a custom method to return the right conditions for the query.</p>

<p>My model already had the <code>filterArgs</code> setup.</p>

<p>```php
/<em>*
 * Setup default search filters
 *
 * @var array
 </em>/</p>

<pre><code>public $filterArgs = [
    'day_type_id' =&gt; ['type' =&gt; 'value'],
    'month' =&gt; ['type' =&gt; 'query', 'method' =&gt; 'filterByMonth']
];
</code></pre>

<p>```</p>

<p>So I just added a <code>type</code> of <code>query</code> and passed in a <code>method</code>.</p>

<p>```php
/<strong>
 * Filter the pagination by month
 *
 * @param array $data
 * @return array
 </strong>/</p>

<pre><code>public function filterByMonth(array $data = array()) {
    return [
        "DATE_FORMAT({$this-&gt;alias}.date, '%c')" =&gt; (int)$data['month']
    ];
}
</code></pre>

<p>```</p>

<p>The <code>$data</code> array will contain all the fields setup in your model along with their values. So for me it looked like</p>

<p>```php
[</p>

<pre><code>'day_type_id' =&gt; 3,
'month' =&gt; '08' // Note the string type, hence why I cast to int
</code></pre>

<p>]
```</p>

<h3>Done!</h3>

<p>Make a brew!</p>
]]></content>
  </entry>
  
</feed>
